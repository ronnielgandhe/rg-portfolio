<svg width="700" height="400" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="700" height="400" fill="#2e3440"/>
  
  <!-- Title -->
  <text x="350" y="30" font-family="monospace" font-size="18" fill="#eceff4" text-anchor="middle" font-weight="bold">
    Orchestration Loop: Plan → Act → Verify → Approve/Rollback
  </text>
  
  <!-- Plan Box -->
  <g>
    <rect x="50" y="70" width="200" height="80" rx="8" fill="#5e81ac" stroke="#88c0d0" stroke-width="2"/>
    <text x="150" y="100" font-family="monospace" font-size="14" fill="#eceff4" text-anchor="middle" font-weight="bold">
      1. PLAN
    </text>
    <text x="150" y="120" font-family="monospace" font-size="11" fill="#d8dee9" text-anchor="middle">
      Goal → Structured steps
    </text>
    <text x="150" y="135" font-family="monospace" font-size="10" fill="#d8dee9" text-anchor="middle">
      Typed I/O contracts
    </text>
  </g>
  
  <!-- Arrow: Plan → Act -->
  <path d="M 150 150 L 150 180" stroke="#88c0d0" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Act Box -->
  <g>
    <rect x="50" y="180" width="200" height="80" rx="8" fill="#5e81ac" stroke="#88c0d0" stroke-width="2"/>
    <text x="150" y="210" font-family="monospace" font-size="14" fill="#eceff4" text-anchor="middle" font-weight="bold">
      2. ACT
    </text>
    <text x="150" y="230" font-family="monospace" font-size="11" fill="#d8dee9" text-anchor="middle">
      Execute tools
    </text>
    <text x="150" y="245" font-family="monospace" font-size="10" fill="#d8dee9" text-anchor="middle">
      Retries + timeouts
    </text>
  </g>
  
  <!-- Arrow: Act → Verify -->
  <path d="M 150 260 L 150 290" stroke="#88c0d0" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Verify Box -->
  <g>
    <rect x="50" y="290" width="200" height="80" rx="8" fill="#5e81ac" stroke="#88c0d0" stroke-width="2"/>
    <text x="150" y="320" font-family="monospace" font-size="14" fill="#eceff4" text-anchor="middle" font-weight="bold">
      3. VERIFY
    </text>
    <text x="150" y="340" font-family="monospace" font-size="11" fill="#d8dee9" text-anchor="middle">
      Check acceptance criteria
    </text>
    <text x="150" y="355" font-family="monospace" font-size="10" fill="#d8dee9" text-anchor="middle">
      Validation + logs
    </text>
  </g>
  
  <!-- Arrow: Verify → Policy Gate -->
  <path d="M 250 330 L 280 330" stroke="#88c0d0" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Policy Gate (Diamond) -->
  <g>
    <polygon points="380,250 480,330 380,410 280,330" fill="#3b4252" stroke="#88c0d0" stroke-width="2"/>
    <text x="380" y="320" font-family="monospace" font-size="14" fill="#eceff4" text-anchor="middle" font-weight="bold">
      POLICY
    </text>
    <text x="380" y="340" font-family="monospace" font-size="14" fill="#eceff4" text-anchor="middle" font-weight="bold">
      GATE
    </text>
  </g>
  
  <!-- Arrow: Policy → Approve (Success path) -->
  <path d="M 480 330 L 520 330" stroke="#a3be8c" stroke-width="3" fill="none" marker-end="url(#arrowhead-success)"/>
  <text x="500" y="320" font-family="monospace" font-size="11" fill="#a3be8c" text-anchor="middle">
    Pass
  </text>
  
  <!-- Approve Box -->
  <g>
    <rect x="520" y="290" width="150" height="80" rx="8" fill="#a3be8c" stroke="#d8dee9" stroke-width="2"/>
    <text x="595" y="320" font-family="monospace" font-size="14" fill="#2e3440" text-anchor="middle" font-weight="bold">
      ✓ APPROVED
    </text>
    <text x="595" y="340" font-family="monospace" font-size="11" fill="#2e3440" text-anchor="middle">
      Execute & log
    </text>
    <text x="595" y="355" font-family="monospace" font-size="10" fill="#2e3440" text-anchor="middle">
      Persist artifacts
    </text>
  </g>
  
  <!-- Arrow: Policy → Rollback (Failure path) -->
  <path d="M 380 410 L 380 450 L 150 450 L 150 150" stroke="#bf616a" stroke-width="3" fill="none" marker-end="url(#arrowhead-fail)" stroke-dasharray="5,5"/>
  <text x="260" y="470" font-family="monospace" font-size="11" fill="#bf616a" text-anchor="middle">
    Fail / Escalate
  </text>
  
  <!-- Rollback Box -->
  <g>
    <rect x="200" y="440" width="160" height="60" rx="8" fill="#bf616a" stroke="#d8dee9" stroke-width="2"/>
    <text x="280" y="465" font-family="monospace" font-size="14" fill="#eceff4" text-anchor="middle" font-weight="bold">
      ✗ ROLLBACK
    </text>
    <text x="280" y="485" font-family="monospace" font-size="11" fill="#eceff4" text-anchor="middle">
      Compensate / replan
    </text>
  </g>
  
  <!-- Legend -->
  <g>
    <text x="30" y="30" font-family="monospace" font-size="10" fill="#d8dee9">
      Legend:
    </text>
    <line x1="30" y1="40" x2="80" y2="40" stroke="#a3be8c" stroke-width="2"/>
    <text x="85" y="43" font-family="monospace" font-size="9" fill="#d8dee9">
      Success
    </text>
    <line x1="30" y1="50" x2="80" y2="50" stroke="#bf616a" stroke-width="2" stroke-dasharray="5,5"/>
    <text x="85" y="53" font-family="monospace" font-size="9" fill="#d8dee9">
      Failure
    </text>
  </g>
  
  <!-- Arrow marker definitions -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#88c0d0"/>
    </marker>
    <marker id="arrowhead-success" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#a3be8c"/>
    </marker>
    <marker id="arrowhead-fail" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#bf616a"/>
    </marker>
  </defs>
</svg>
