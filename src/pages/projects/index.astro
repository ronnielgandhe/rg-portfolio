---
export const prerender = false;
import { getCollection } from 'astro:content';
import { getImage } from 'astro:assets';
import Layout from '../../layouts/Layout.astro';
import ProjectsLayout from '../../layouts/ProjectsLayout';
import { getRecentBlogPosts } from '../../utils/blog';
import { getFixedBackgroundKey, getOptimizedBackgrounds } from '../../utils/backgrounds';

// Fetch all projects from content collection
const allProjects = await getCollection('projects');

// Sort by year (most recent first)
const sortedProjects = allProjects.sort((a, b) => b.data.year - a.data.year);

// Format projects for the ProjectsLayout component
const projects = sortedProjects.map((project) => ({
  title: project.data.title,
  slug: project.id,
  year: project.data.year,
  tech: project.data.tech,
  summary: project.data.summary,
  status: project.data.year === 2025 ? 'In Development' : 'Live',
  repoUrl: project.data.repoUrl
}));

// Get optimized backgrounds
const backgroundMap = await getOptimizedBackgrounds(getImage);

// Fetch recent blog posts for navigation
const recentPosts = await getRecentBlogPosts();
---

<Layout
  title='Projects - Ronniel Gandhe'
  description='Software projects by Ronniel Gandhe - systematic trading tools and scalable infrastructure'
  canonical='https://ronnielgandhe.com/projects'
>
  <ProjectsLayout
    client:load
    projects={projects}
    initialBg={getFixedBackgroundKey()}
    backgroundMap={backgroundMap}
    recentPosts={recentPosts}
  />
</Layout>