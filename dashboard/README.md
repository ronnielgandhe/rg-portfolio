# Gold vs. Nasdaq Divergence Dashboard

Quick setup instructions for visualizing the divergence signal in Tableau or Power BI.

## Data Source

The signal data is generated by `src/gold_vs_nasdaq.py` and saved to:
```
./data/gold_nq_signal.csv
```

Run the script first to generate the data:
```bash
python src/gold_vs_nasdaq.py
```

## Dashboard Components

### 1. Time Series Chart
- **X-axis**: Date
- **Y-axis**: Z-score
- **Reference lines**:
  - +2.0 (strong risk-on, red)
  - +1.5 (moderate risk-on, orange)
  - 0 (neutral, gray)
  - -1.5 (moderate risk-off, orange)
  - -2.0 (strong risk-off, red)
- **Recommended**: Last 90 days for clarity, with full history available on zoom

### 2. Latest Signal Card
- **Metric**: Current z-score (large font)
- **Conditional formatting**:
  - Green: -1 < z < 1 (normal regime)
  - Yellow: 1 < |z| < 1.5 (elevated divergence)
  - Red: |z| > 1.5 (significant divergence)
- **Subtext**: Date, eps, beta_xau

### 3. Regime Distribution
- **Chart type**: Histogram of z-scores
- **Purpose**: Show historical distribution to contextualize current reading

### 4. Rolling Beta
- **X-axis**: Date
- **Y-axis**: beta_xau
- **Purpose**: Track how Nasdaq sensitivity to gold changes over time
- **Note**: Typically negative (inverse relationship)

## Tableau Setup

### Connection
1. Open Tableau Desktop
2. Connect to Data > Text File
3. Select `data/gold_nq_signal.csv`
4. Verify data types:
   - Date column: Date
   - z, eps, beta_xau, alpha, eps_std: Number (decimal)

### Refresh
- For live dashboard, set up automatic refresh (Data > Extract Data > Schedule Extract)
- Or use Tableau Server with scheduled refresh task
- Alternatively, connect via API endpoint (see below)

### Calculated Fields
```
Signal Regime:
IF [z] > 1.5 THEN "Strong Risk-On"
ELSEIF [z] > 1 THEN "Moderate Risk-On"
ELSEIF [z] > -1 THEN "Normal"
ELSEIF [z] > -1.5 THEN "Moderate Risk-Off"
ELSE "Strong Risk-Off"
END

Signal Color:
IF ABS([z]) > 1.5 THEN "Red"
ELSEIF ABS([z]) > 1 THEN "Yellow"
ELSE "Green"
END
```

## Power BI Setup

### Connection
1. Home > Get Data > Text/CSV
2. Browse to `data/gold_nq_signal.csv`
3. Transform Data:
   - Ensure `Date` column is Date type
   - Ensure numeric columns are Decimal Number type

### Measures
```dax
Latest Z-Score = 
CALCULATE(
    MAX('gold_nq_signal'[z]),
    LASTDATE('gold_nq_signal'[Date])
)

Signal Color = 
VAR zScore = [Latest Z-Score]
RETURN
    SWITCH(
        TRUE(),
        ABS(zScore) > 1.5, "Red",
        ABS(zScore) > 1, "Yellow",
        "Green"
    )
```

### Refresh
- For automatic updates, publish to Power BI Service
- Set up scheduled refresh in dataset settings
- Or use API endpoint with Power BI streaming dataset

## API-Based Dashboard (Advanced)

For real-time updates without file dependency:

### Option 1: Tableau Web Data Connector
1. Create WDC pointing to: `http://localhost:8000/signals/gold-nq`
2. Use Tableau's Web Data Connector SDK
3. Refresh on dashboard load

### Option 2: Power BI Custom Connector
1. Use Power Query M to call API:
```m
let
    Source = Json.Document(Web.Contents("http://localhost:8000/signals/gold-nq")),
    #"Converted to Table" = Record.ToTable(Source)
in
    #"Converted to Table"
```

### Option 3: Python Bridge (Both Tools)
Run API server, then use Python script to fetch and write to local file:
```python
import requests
import pandas as pd

response = requests.get("http://localhost:8000/signals/gold-nq")
data = response.json()
df = pd.DataFrame([data])
df.to_csv("data/gold_nq_latest.csv", index=False)
```
Schedule this with cron (macOS/Linux) or Task Scheduler (Windows).

## Example Dashboard Layout

```
+----------------------------------+------------------+
|  Z-Score Time Series (90 days)  |  Latest Signal  |
|                                  |   z = -1.23     |
|  [Line chart with bands]         |   (Risk-Off)    |
|                                  |  2025-10-12     |
+----------------------------------+------------------+
|  Rolling Beta                    |  Z Distribution |
|  [Line chart]                    |  [Histogram]    |
+----------------------------------+------------------+
```

## File Location

If using the provided Power BI template:
```
dashboard/gold_nq.pbix
```

Simply open in Power BI Desktop and click "Refresh" to load latest data.

## Notes

- CSV updates daily when you run `gold_vs_nasdaq.py`
- For intraday updates, run the API (`uvicorn src.api:app`) and connect via API
- Historical data starts from 2015-01-01 (configurable in script)
- Window size is 90 days (configurable)

## Troubleshooting

**Issue**: Data not updating in Tableau/Power BI  
**Fix**: Ensure CSV exists at `./data/gold_nq_signal.csv` and run Data > Refresh

**Issue**: API connection fails  
**Fix**: Start API server: `uvicorn src.api:app --port 8000`

**Issue**: Dates showing as text  
**Fix**: In data source settings, change column type to Date

## Next Steps

Consider adding:
- VIX overlay (volatility context)
- DXY line (dollar strength)
- Real yield time series (TIPS breakevens)
- Regime change annotations (FOMC, CPI dates)
